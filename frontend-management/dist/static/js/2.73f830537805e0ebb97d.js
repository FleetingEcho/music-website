webpackJsonp([2],{"Nz/M":function(t,e){},QCHQ:function(t,e,i){"use strict";var n=i("Dd8w"),a=i.n(n),s=i("NYxO"),r={name:"song-audio",computed:a()({},Object(s.b)(["id","url","isPlay"])),watch:{isPlay:function(){this.togglePlay()}},methods:{togglePlay:function(){var t=document.querySelector("#player");this.isPlay?t.play():t.pause()},startPlay:function(){document.querySelector("#player").play()},ended:function(){this.isPlay=!1}}},l={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"song-audio"},[e("audio",{attrs:{id:"player",controls:"controls",preload:"true",src:this.url},on:{canplay:this.startPlay,ended:this.ended}})])},staticRenderFns:[]};var o=i("VU/8")(r,l,!1,function(t){i("Nz/M")},null,null);e.a=o.exports},Us0B:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("BO1k"),a=i.n(n),s=i("Dd8w"),r=i.n(s),l=i("QCHQ"),o=i("msXN"),c=i("NYxO"),d="#icon-bofanganniu",u="#icon-zanting",m=i("gyMJ"),f={name:"song-page",components:{SongAudio:l.a},mixins:[o.a],data:function(){return{toggle:!1,singerId:"",singerName:"",registerForm:{name:"",singerName:"",introduction:"",lyric:""},tableData:[],tempDate:[],is_search:!1,multipleSelection:[],centerDialogVisible:!1,editVisible:!1,delVisible:!1,select_word:"",form:{id:"",singerId:"",name:"",introduction:"",createTime:"",updateTime:"",pic:"",lyric:"",url:""},pageSize:5,currentPage:1,idx:-1,BOFANG:d,ZANTING:u}},computed:r()({},Object(c.b)(["isPlay"]),{data:function(){return this.tableData.slice((this.currentPage-1)*this.pageSize,this.currentPage*this.pageSize)},playIcon:function(){return this.isPlay?this.ZANTING:this.BOFANG}}),watch:{select_word:function(){if(""===this.select_word)this.tableData=this.tempDate;else{this.tableData=[];var t=!0,e=!1,i=void 0;try{for(var n,s=a()(this.tempDate);!(t=(n=s.next()).done);t=!0){var r=n.value;r.name.includes(this.select_word)&&this.tableData.push(r)}}catch(t){e=!0,i=t}finally{try{!t&&s.return&&s.return()}finally{if(e)throw i}}}}},created:function(){this.singerId=this.$route.query.id,this.singerName=this.$route.query.name,this.getData()},destroyed:function(){this.$store.commit("setIsPlay",!1)},methods:{getData:function(){var t=this;this.tableData=[],this.tempDate=[],m.a.getSongOfSingerId(this.singerId).then(function(e){t.tableData=e,t.tempDate=e,t.currentPage=1}).catch(function(t){console.log(t)})},setSongUrl:function(t,e){this.$store.commit("setUrl",this.$store.state.HOST+t),this.toggle=e,this.isPlay?this.$store.commit("setIsPlay",!1):this.$store.commit("setIsPlay",!0)},uploadUrl:function(t){return this.$store.state.HOST+"/song/img/update?id="+t},uploadSongUrl:function(t){return this.$store.state.HOST+"/song/url/update?id="+t},beforeSongUpload:function(t){var e="mp3"===t.name.substring(t.name.lastIndexOf(".")+1);return e||this.$message({message:"上传文件只能是mp3格式！",type:"error"}),e},handleCurrentChange:function(t){this.currentPage=t},handleSongSuccess:function(t,e){1===t.code?(this.getData(),this.notify("上传成功","success")):this.notify("上传失败","error")},addSong:function(){var t=this,e=new FormData(document.getElementById("tf"));e.append("singerId",this.singerId),e.set("name",this.singerName+"-"+e.get("name")),e.get("lyric")||e.set("lyric","[00:00:00]暂无歌词");var i=new XMLHttpRequest;i.onreadystatechange=function(){if(4===i.readyState&&200===i.status){var e=JSON.parse(i.response);e.code?(t.getData(),t.registerForm={},t.notify(e.msg,"success")):e.code||t.notify("上传失败","error")}},i.open("post",t.$store.state.HOST+"/song/add",!1),i.send(e),t.centerDialogVisible=!1},handleEdit:function(t){this.idx=t.id,this.form={id:t.id,singerId:t.singerId,name:t.name,introduction:t.introduction,createTime:t.createTime,updateTime:t.updateTime,pic:t.pic,lyric:t.lyric,url:t.url},this.editVisible=!0},getComment:function(t){this.$router.push({path:"/Comment",query:{id:t,type:0}})},saveEdit:function(){var t=this,e=new URLSearchParams;e.append("id",this.form.id),e.append("singerId",this.form.singerId),e.append("name",this.form.name),e.append("introduction",this.form.introduction),e.append("lyric",this.form.lyric),m.a.updateSongMsg(e).then(function(e){e?(t.getData(),t.notify("Modified successfully","success")):t.notify("Failed to modify","error")}).catch(function(t){console.log(t)}),this.editVisible=!1},deleteRow:function(){var t=this;m.a.deleteSong(this.idx).then(function(e){e?(t.getData(),t.notify("Deleted successfully","success")):t.notify("Failed to delete","error")}).catch(function(t){console.log(t)}),this.delVisible=!1},parseLyric:function(t){var e=t.split("\n"),i=/\[\d{2}:\d{2}.(\d{3}|\d{2})\]/g,n=[];if(!/\[.+\]/.test(t))return[t];var s=!0,r=!1,l=void 0;try{for(var o,c=a()(e);!(s=(o=c.next()).done);s=!0){var d=o.value;if(i.test(d)){var u=d.replace(i,"");n.push(u)}}}catch(t){r=!0,l=t}finally{try{!s&&c.return&&c.return()}finally{if(r)throw l}}return n}}},p={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"table"},[i("div",{staticClass:"crumbs"},[i("el-breadcrumb",{attrs:{separator:"/"}},[i("el-breadcrumb-item",[i("i",{staticClass:"el-icon-tickets"}),t._v(" Song information\n      ")])],1)],1),t._v(" "),i("div",{staticClass:"container"},[i("div",{staticClass:"handle-box"},[i("el-button",{staticClass:"handle-del mr10",attrs:{type:"primary",size:"mini"},on:{click:t.delAll}},[t._v("Batch delete")]),t._v(" "),i("el-input",{staticClass:"handle-input mr10",attrs:{size:"mini",placeholder:"Select keywords"},model:{value:t.select_word,callback:function(e){t.select_word=e},expression:"select_word"}}),t._v(" "),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(e){t.centerDialogVisible=!0}}},[t._v("Add songs")])],1),t._v(" "),i("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.data,size:"mini",border:"",height:"550px"},on:{"selection-change":t.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"40"}}),t._v(" "),i("el-table-column",{attrs:{label:"Singer images",width:"110",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("div",{staticStyle:{width:"80px",height:"80px",overflow:"hidden"}},[i("img",{staticStyle:{width:"100%"},attrs:{src:t.getUrl(e.row.pic),alt:""}})]),t._v(" "),i("div",{staticClass:"play",on:{click:function(i){return t.setSongUrl(e.row.url,e.row.name)}}},[t.toggle!==e.row.name?i("div",[i("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[i("use",{attrs:{"xlink:href":t.BOFANG}})])]):t._e(),t._v(" "),t.toggle===e.row.name?i("div",[i("svg",{staticClass:"icon",attrs:{"aria-hidden":"true"}},[i("use",{attrs:{"xlink:href":t.playIcon}})])]):t._e()])]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"Song",prop:"name",width:"150",align:"center"}}),t._v(" "),i("el-table-column",{attrs:{label:"Album",prop:"introduction",width:"150",align:"center"}}),t._v(" "),i("el-table-column",{attrs:{label:"Lyric",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("ul",{staticStyle:{height:"100px",overflow:"scroll"}},[i("li"),t._v(" "),t._l(t.parseLyric(e.row.lyric),function(e,n){return i("li",{key:n},[t._v("\n              "+t._s(e)+"\n            ")])})],2)]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"Resource update",width:"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-upload",{staticClass:"upload-demo",attrs:{action:t.uploadUrl(e.row.id),"show-file-list":!1,"on-success":t.handleAvatarSuccess,"before-upload":t.beforeAvatarUpload}},[i("el-button",{attrs:{size:"mini"}},[t._v("Update image")])],1),t._v(" "),i("br"),t._v(" "),i("el-upload",{staticClass:"upload-demo change",attrs:{action:t.uploadSongUrl(e.row.id),"show-file-list":!1,"on-success":t.handleSongSuccess,"before-upload":t.beforeSongUpload}},[i("el-button",{attrs:{size:"mini"}},[t._v("Update song")])],1)]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"Comment",width:"80",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{size:"mini"},on:{click:function(i){return t.getComment(t.data[e.$index].id)}}},[t._v("comment")])]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"Operation",width:"150",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{size:"mini"},on:{click:function(i){return t.handleEdit(e.row)}}},[t._v("Modify")]),t._v(" "),i("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(i){return t.handleDelete(e.row.id)}}},[t._v("Delete")])]}}])})],1),t._v(" "),i("div",{staticClass:"pagination"},[i("el-pagination",{attrs:{background:"",layout:"total, prev, pager, next","current-page":t.currentPage,"page-size":t.pageSize,total:t.tableData.length},on:{"current-change":t.handleCurrentChange}})],1)],1),t._v(" "),i("el-dialog",{attrs:{title:"Add song",visible:t.centerDialogVisible,width:"400px",center:""},on:{"update:visible":function(e){t.centerDialogVisible=e}}},[i("el-form",{attrs:{action:"",model:t.registerForm,id:"tf"}},[i("div",[i("label",[t._v("Song")]),t._v(" "),i("el-input",{attrs:{type:"text",name:"name"}})],1),t._v(" "),i("div",[i("label",[t._v("Album")]),t._v(" "),i("el-input",{attrs:{type:"text",value:"",name:"introduction"}})],1),t._v(" "),i("div",[i("label",[t._v("Lyric")]),t._v(" "),i("el-input",{attrs:{type:"textarea",value:"",name:"lyric"}})],1),t._v(" "),i("div",[i("label",[t._v("Upload-song")]),t._v(" "),i("br"),t._v(" "),i("input",{attrs:{type:"file",name:"file",id:"update-file-input"}})])]),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.centerDialogVisible=!1}}},[t._v("Cancel")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:t.addSong}},[t._v("OK")])],1)],1),t._v(" "),i("el-dialog",{attrs:{title:"Modify",visible:t.editVisible,width:"600px"},on:{"update:visible":function(e){t.editVisible=e}}},[i("el-form",{ref:"form",attrs:{model:t.form,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"Singer-song",size:"mini"}},[i("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"Introduction",size:"mini"}},[i("el-input",{model:{value:t.form.introduction,callback:function(e){t.$set(t.form,"introduction",e)},expression:"form.introduction"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"Lyric",size:"mini"}},[i("el-input",{attrs:{type:"textarea"},model:{value:t.form.lyric,callback:function(e){t.$set(t.form,"lyric",e)},expression:"form.lyric"}})],1)],1),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"mini"},on:{click:function(e){t.editVisible=!1}}},[t._v("Cancel")]),t._v(" "),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.saveEdit}},[t._v("OK")])],1)],1),t._v(" "),i("el-dialog",{attrs:{title:"Hint",visible:t.delVisible,width:"300px",center:""},on:{"update:visible":function(e){t.delVisible=e}}},[i("div",{staticClass:"del-dialog-cnt",attrs:{align:"center"}},[t._v("\n      Delete is unrecoverable, is it determined to delete?\n    ")]),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"mini"},on:{click:function(e){t.delVisible=!1}}},[t._v("Cancel")]),t._v(" "),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.deleteRow}},[t._v("Delete")])],1)])],1)},staticRenderFns:[]};var g=i("VU/8")(f,p,!1,function(t){i("glHa")},"data-v-1fb5f887",null);e.default=g.exports},glHa:function(t,e){}});
//# sourceMappingURL=2.73f830537805e0ebb97d.js.map